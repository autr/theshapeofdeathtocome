function riseTombstone(e){e.position.y=-e.tombHeight/2;var t=new TWEEN.Tween(e.position).to({y:e.tombHeight/2+.5},6e3).onUpdate(function(){}).onComplete(function(){}).easing(TWEEN.Easing.Quadratic.InOut).start()}function createTombStone(e,t){var n=new Promise(function(n,a){var r=randomTexture();r.then(function(a){var r=10,o=.5*r,i=a.materials[4].map.image?o/800*a.materials[5].map.image.height:r,s=.1*r,u=new THREE.BoxGeometry(o,i,s),d=new THREE.Mesh(u,a);d.tombHeight=i,d.position.y=-i/2,d.position.x=e,d.position.z=t,shadow&&(d.receiveShadow=!0),shadow&&(d.castShadow=!0),scene.add(d),n(d)},function(e){console.log("Fail",e)})});return n}function randomTexture(){var e=new Promise(function(e,t){shuffledIndex=shuffledIndex<shuffled.length-1?shuffledIndex+1:0;for(var n=websites[shuffled[shuffledIndex]];-1!==n.indexOf("%2F");){var a=n.indexOf("%2F");n=n.substr(0,a+1)+"25"+n.substr(a+1)}for(;-1!==n.indexOf("%40");){var a=n.indexOf("%40");n=n.substr(0,a+1)+"25"+n.substr(a+1)}texture=new THREE.TextureLoader(manager).load("graves/"+n,function(){texture.minFilter=THREE.LinearFilter,texture.originalUrl=n;try{dummyCtx.drawImage(texture.image,0,0,1,1);var t=dummyCtx.getImageData(0,0,1,1).data,a="rgb("+t[0]+","+t[1]+","+t[2]+")",r=new THREE.MeshPhongMaterial({color:a})}catch(o){var r=new THREE.MeshPhongMaterial({color:"rgb(255,255,255)"})}var i=new THREE.MeshBasicMaterial({map:texture,needsUpdate:!0}),s=[r,r,r,r,i,i],u=new THREE.MeshFaceMaterial(s);e(u)})});return e}function updateRandomTexture(e){riseTombstone(e);var t=randomTexture();t.then(function(t){e.material=t,e.needsUpdate=!0},function(e){})}